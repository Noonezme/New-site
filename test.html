<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>SyncStream - Fake Fullscreen</title>
<style>
body {
  font-family: 'Segoe UI', sans-serif;
  background: #0e0e10;
  color: #fff;
  margin: 0;
  padding: 0;
}
header {
  padding: 15px;
  background: #1a1a1f;
  text-align: center;
}
header input[type="file"] {
  margin-top: 10px;
  padding: 6px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  font-weight: bold;
  background: #fdbb2d;
  color: #111;
}
.fullscreen-wrapper {
  position: fixed;
  top:0;
  left:0;
  width:100vw;
  height:100vh;
  background:#0e0e10;
  display:flex;
  flex-direction:row;
  z-index:9999;
}
.fullscreen-video {
  flex:2;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  position:relative;
}
.fullscreen-video video {
  width:100%;
  max-height:100%;
  border-radius:10px;
  box-shadow:0 0 20px rgba(0,0,0,0.5);
}
.fullscreen-chat {
  flex:1;
  display:flex;
  flex-direction:column;
  background:#141417;
  border-left:2px solid #333;
}
.fullscreen-chat-messages {
  flex:1;
  overflow-y:auto;
  padding:10px;
}
.fullscreen-chat-input {
  display:flex;
  border-top:1px solid #333;
}
.fullscreen-chat-input input {
  flex:1;
  padding:10px;
  border:none;
  outline:none;
}
.fullscreen-chat-input button {
  padding:10px;
  background:#fdbb2d;
  border:none;
  font-weight:bold;
  cursor:pointer;
}
@media(max-width:768px){
  .fullscreen-wrapper { flex-direction:column; }
  .fullscreen-video { flex:3; }
  .fullscreen-chat { flex:2; border-left:none; border-top:2px solid #333; }
}
</style>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
</head>
<body>

<header>
<h1>ðŸŽ¬ SyncStream</h1>
<p>Watch videos together</p>
<input type="file" id="fileInput" accept="video/*"/>
<button id="enterFS">Enter Fullscreen Mode</button>
</header>

<div id="fakeFullscreen" class="fullscreen-wrapper" style="display:none;">
  <div class="fullscreen-video">
    <video id="videoFS" controls></video>
  </div>
  <div class="fullscreen-chat">
    <div class="fullscreen-chat-messages" id="chatFS"></div>
    <div class="fullscreen-chat-input">
      <input id="chatInputFS" type="text" placeholder="Type a message...">
      <button id="sendFS">Send</button>
    </div>
  </div>
</div>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyD5CSVD8q_jKxxnmX65Do1V5NALdX1oYO0",
  authDomain: "wechatwatch-e76ae.firebaseapp.com",
  databaseURL: "https://wechatwatch-e76ae-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "wechatwatch-e76ae",
  storageBucket: "wechatwatch-e76ae.firebasestorage.app",
  messagingSenderId: "247455453850",
  appId: "1:247455453850:web:a9481b0e1b825c4cf74523",
  measurementId: "G-WQ9S69L3DY"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const storage = firebase.storage();

// Username
let username = localStorage.getItem("username");
if(!username){
  username = prompt("Enter your name:") || "Guest"+Math.floor(Math.random()*1000);
  localStorage.setItem("username", username);
}

// Elements
const fileInput = document.getElementById("fileInput");
const fakeFS = document.getElementById("fakeFullscreen");
const videoFS = document.getElementById("videoFS");
const chatFS = document.getElementById("chatFS");
const chatInputFS = document.getElementById("chatInputFS");
const sendFS = document.getElementById("sendFS");
const enterFS = document.getElementById("enterFS");

// Upload video
fileInput.addEventListener("change", e=>{
  const file = e.target.files[0];
  if(!file) return;
  videoFS.src = URL.createObjectURL(file);

  const storageRef = storage.ref("videos/"+file.name);
  const uploadTask = storageRef.put(file);

  uploadTask.on("state_changed", null, console.error, async ()=>{
    const url = await uploadTask.snapshot.ref.getDownloadURL();
    db.ref("sessions/MAIN/videoFile").set(url);
  });
});

// Listen for video URL
db.ref("sessions/MAIN/videoFile").on("value", snap=>{
  const url = snap.val();
  if(url && videoFS.src !== url){
    videoFS.src = url;
  }
});

// Sync play/pause/seek
videoFS.addEventListener("play", ()=>db.ref("sessions/MAIN/videoState").set({state:"play",time:videoFS.currentTime}));
videoFS.addEventListener("pause", ()=>db.ref("sessions/MAIN/videoState").set({state:"pause",time:videoFS.currentTime}));
videoFS.addEventListener("seeking", ()=>db.ref("sessions/MAIN/videoState").set({state:"seek",time:videoFS.currentTime}));

db.ref("sessions/MAIN/videoState").on("value", snap=>{
  const data = snap.val();
  if(!data) return;
  if(data.state==="play" && videoFS.paused){videoFS.currentTime=data.time; videoFS.play();}
  else if(data.state==="pause" && !videoFS.paused){videoFS.currentTime=data.time; videoFS.pause();}
  else if(data.state==="seek"){videoFS.currentTime=data.time;}
});

// Send chat
function sendFSMessage(){
  const msg = chatInputFS.value.trim();
  if(!msg) return;
  db.ref("sessions/MAIN/chat").push({user:username,text:msg,time:Date.now()});
  chatInputFS.value="";
}
sendFS.addEventListener("click", sendFSMessage);
chatInputFS.addEventListener("keypress", e=>{if(e.key==="Enter") sendFSMessage();});

// Chat + sound
const msgSound = new Audio("https://www.myinstants.com/media/sounds/message.mp3");
db.ref("sessions/MAIN/chat").on("child_added", snap=>{
  const data = snap.val();
  const text = `${data.user}: ${data.text}`;
  const div = document.createElement("div");
  div.textContent = text;
  chatFS.appendChild(div);
  chatFS.scrollTop = chatFS.scrollHeight;

  msgSound.currentTime = 0;
  msgSound.play();
});

// Users online
const userId = "user_"+Math.floor(Math.random()*10000);
const userRef = db.ref("sessions/MAIN/users/"+userId);
userRef.set({name:username,joined:Date.now(),lastActive:Date.now()});
userRef.onDisconnect().remove();
db.ref("sessions/MAIN/users").on("value", snap=>{
  // Optionally, you can display online users
});

// Enter fake fullscreen
enterFS.addEventListener("click", ()=>{
  fakeFS.style.display = "flex";
});
</script>
</body>
</html>
